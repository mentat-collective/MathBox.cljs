{
"version":3,
"file":"module$node_modules$three$src$renderers$webxr$WebXRController.js",
"lineCount":9,
"mappings":"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",
"sources":["node_modules/three/src/renderers/webxr/WebXRController.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$three$src$renderers$webxr$WebXRController\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebXRController = void 0;\n\nvar _Vector = require(\"../../math/Vector3.js\");\n\nvar _Group = require(\"../../objects/Group.js\");\n\nconst _moveEvent = {\n  type: 'move'\n};\n\nclass WebXRController {\n  constructor() {\n    this._targetRay = null;\n    this._grip = null;\n    this._hand = null;\n  }\n\n  getHandSpace() {\n    if (this._hand === null) {\n      this._hand = new _Group.Group();\n      this._hand.matrixAutoUpdate = false;\n      this._hand.visible = false;\n      this._hand.joints = {};\n      this._hand.inputState = {\n        pinching: false\n      };\n    }\n\n    return this._hand;\n  }\n\n  getTargetRaySpace() {\n    if (this._targetRay === null) {\n      this._targetRay = new _Group.Group();\n      this._targetRay.matrixAutoUpdate = false;\n      this._targetRay.visible = false;\n      this._targetRay.hasLinearVelocity = false;\n      this._targetRay.linearVelocity = new _Vector.Vector3();\n      this._targetRay.hasAngularVelocity = false;\n      this._targetRay.angularVelocity = new _Vector.Vector3();\n    }\n\n    return this._targetRay;\n  }\n\n  getGripSpace() {\n    if (this._grip === null) {\n      this._grip = new _Group.Group();\n      this._grip.matrixAutoUpdate = false;\n      this._grip.visible = false;\n      this._grip.hasLinearVelocity = false;\n      this._grip.linearVelocity = new _Vector.Vector3();\n      this._grip.hasAngularVelocity = false;\n      this._grip.angularVelocity = new _Vector.Vector3();\n    }\n\n    return this._grip;\n  }\n\n  dispatchEvent(event) {\n    if (this._targetRay !== null) {\n      this._targetRay.dispatchEvent(event);\n    }\n\n    if (this._grip !== null) {\n      this._grip.dispatchEvent(event);\n    }\n\n    if (this._hand !== null) {\n      this._hand.dispatchEvent(event);\n    }\n\n    return this;\n  }\n\n  connect(inputSource) {\n    if (inputSource && inputSource.hand) {\n      const hand = this._hand;\n\n      if (hand) {\n        for (const inputjoint of inputSource.hand.values()) {\n          // Initialize hand with joints when connected\n          this._getHandJoint(hand, inputjoint);\n        }\n      }\n    }\n\n    this.dispatchEvent({\n      type: 'connected',\n      data: inputSource\n    });\n    return this;\n  }\n\n  disconnect(inputSource) {\n    this.dispatchEvent({\n      type: 'disconnected',\n      data: inputSource\n    });\n\n    if (this._targetRay !== null) {\n      this._targetRay.visible = false;\n    }\n\n    if (this._grip !== null) {\n      this._grip.visible = false;\n    }\n\n    if (this._hand !== null) {\n      this._hand.visible = false;\n    }\n\n    return this;\n  }\n\n  update(inputSource, frame, referenceSpace) {\n    let inputPose = null;\n    let gripPose = null;\n    let handPose = null;\n    const targetRay = this._targetRay;\n    const grip = this._grip;\n    const hand = this._hand;\n\n    if (inputSource && frame.session.visibilityState !== 'visible-blurred') {\n      if (hand && inputSource.hand) {\n        handPose = true;\n\n        for (const inputjoint of inputSource.hand.values()) {\n          // Update the joints groups with the XRJoint poses\n          const jointPose = frame.getJointPose(inputjoint, referenceSpace); // The transform of this joint will be updated with the joint pose on each frame\n\n          const joint = this._getHandJoint(hand, inputjoint);\n\n          if (jointPose !== null) {\n            joint.matrix.fromArray(jointPose.transform.matrix);\n            joint.matrix.decompose(joint.position, joint.rotation, joint.scale);\n            joint.jointRadius = jointPose.radius;\n          }\n\n          joint.visible = jointPose !== null;\n        } // Custom events\n        // Check pinchz\n\n\n        const indexTip = hand.joints['index-finger-tip'];\n        const thumbTip = hand.joints['thumb-tip'];\n        const distance = indexTip.position.distanceTo(thumbTip.position);\n        const distanceToPinch = 0.02;\n        const threshold = 0.005;\n\n        if (hand.inputState.pinching && distance > distanceToPinch + threshold) {\n          hand.inputState.pinching = false;\n          this.dispatchEvent({\n            type: 'pinchend',\n            handedness: inputSource.handedness,\n            target: this\n          });\n        } else if (!hand.inputState.pinching && distance <= distanceToPinch - threshold) {\n          hand.inputState.pinching = true;\n          this.dispatchEvent({\n            type: 'pinchstart',\n            handedness: inputSource.handedness,\n            target: this\n          });\n        }\n      } else {\n        if (grip !== null && inputSource.gripSpace) {\n          gripPose = frame.getPose(inputSource.gripSpace, referenceSpace);\n\n          if (gripPose !== null) {\n            grip.matrix.fromArray(gripPose.transform.matrix);\n            grip.matrix.decompose(grip.position, grip.rotation, grip.scale);\n\n            if (gripPose.linearVelocity) {\n              grip.hasLinearVelocity = true;\n              grip.linearVelocity.copy(gripPose.linearVelocity);\n            } else {\n              grip.hasLinearVelocity = false;\n            }\n\n            if (gripPose.angularVelocity) {\n              grip.hasAngularVelocity = true;\n              grip.angularVelocity.copy(gripPose.angularVelocity);\n            } else {\n              grip.hasAngularVelocity = false;\n            }\n          }\n        }\n      }\n\n      if (targetRay !== null) {\n        inputPose = frame.getPose(inputSource.targetRaySpace, referenceSpace); // Some runtimes (namely Vive Cosmos with Vive OpenXR Runtime) have only grip space and ray space is equal to it\n\n        if (inputPose === null && gripPose !== null) {\n          inputPose = gripPose;\n        }\n\n        if (inputPose !== null) {\n          targetRay.matrix.fromArray(inputPose.transform.matrix);\n          targetRay.matrix.decompose(targetRay.position, targetRay.rotation, targetRay.scale);\n\n          if (inputPose.linearVelocity) {\n            targetRay.hasLinearVelocity = true;\n            targetRay.linearVelocity.copy(inputPose.linearVelocity);\n          } else {\n            targetRay.hasLinearVelocity = false;\n          }\n\n          if (inputPose.angularVelocity) {\n            targetRay.hasAngularVelocity = true;\n            targetRay.angularVelocity.copy(inputPose.angularVelocity);\n          } else {\n            targetRay.hasAngularVelocity = false;\n          }\n\n          this.dispatchEvent(_moveEvent);\n        }\n      }\n    }\n\n    if (targetRay !== null) {\n      targetRay.visible = inputPose !== null;\n    }\n\n    if (grip !== null) {\n      grip.visible = gripPose !== null;\n    }\n\n    if (hand !== null) {\n      hand.visible = handPose !== null;\n    }\n\n    return this;\n  } // private method\n\n\n  _getHandJoint(hand, inputjoint) {\n    if (hand.joints[inputjoint.jointName] === undefined) {\n      const joint = new _Group.Group();\n      joint.matrixAutoUpdate = false;\n      joint.visible = false;\n      hand.joints[inputjoint.jointName] = joint;\n      hand.add(joint);\n    }\n\n    return hand.joints[inputjoint.jointName];\n  }\n\n}\n\nexports.WebXRController = WebXRController;\n};"],
"names":["shadow$provide","global","require","module","exports","Object","defineProperty","value","WebXRController","_Vector","_Group","_moveEvent","type","constructor","_hand","_grip","_targetRay","getHandSpace","Group","matrixAutoUpdate","visible","joints","inputState","pinching","getTargetRaySpace","hasLinearVelocity","linearVelocity","Vector3","hasAngularVelocity","angularVelocity","getGripSpace","dispatchEvent","event","connect","inputSource","hand","inputjoint","values","_getHandJoint","data","disconnect","update","frame","referenceSpace","inputPose","gripPose","handPose","targetRay","grip","session","visibilityState","jointPose","getJointPose","joint","matrix","fromArray","transform","decompose","position","rotation","scale","jointRadius","radius","distance","indexTip","distanceTo","thumbTip","handedness","target","gripSpace","getPose","copy","targetRaySpace","undefined","jointName","add"]
}
