{"version":3,"sources":["nextjournal/clerk/render/code.cljs"],"mappings":"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","names":["nextjournal.clerk.render.code/highlight-style","js/module$node_modules$$codemirror$language$dist$index_cjs.HighlightStyle","cljs.core/clj->js","js/module$node_modules$$lezer$highlight$dist$index_cjs.tags","var_args","G__53692","nextjournal.clerk.render.code/rangeset-seq","js/Error","rset","nextjournal.clerk.render.code.rangeset_seq","from","iterator","temp__5808__auto__","val","to","cljs.core/cons","cljs.core/LazySeq","step","p__53694","map__53695","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","obj53697","js/undefined","obj53698","nextjournal.clerk.render.code/style->hiccup-tag","tagName","class","cljs.core.keyword","cljs.core/str","cljs.core.interpose","clojure.string.split","p__53699","map__53700","obj53702","obj53703","nextjournal.clerk.render.code/intersects?","range","nextjournal.clerk.render.code/style-line","decos","text","i","map__53704","obj53706","obj53707","obj53708","line","length","cljs.core.into","pos","lds","cljs.core.filter","cljs.core.partial","buf","temp__5806__auto__","map__53713","cljs.core/--destructure-map","cljs.core.get","start","end","style","cljs.core/first","cljs.core/next","cljs.core.concat","G__53714","cljs.core/List","x__5130__auto__","y__5131__auto__","x__5133__auto__","y__5134__auto__","cljs.core.conj","G__53712","nextjournal.clerk.render.code/render-code","code","builder","js/module$node_modules$$codemirror$state$dist$index_cjs.RangeSetBuilder","_","js/module$node_modules$$lezer$highlight$dist$index_cjs.highlightTree","js/module$node_modules$$nextjournal$lang_clojure$dist$index_cjs.clojureLanguage","js/module$node_modules$$codemirror$view$dist$index_cjs.Decoration","decorations-rangeset","js/module$node_modules$$codemirror$state$dist$index_cjs.Text","cljs.core.map","cljs.core.range","nextjournal.clerk.render.code/theme","js/module$node_modules$$codemirror$view$dist$index_cjs.EditorView","nextjournal.clerk.render.code/complete-keymap","js/module$node_modules$$codemirror$view$dist$index_cjs.keymap","nextjournal.clojure-mode.keymap/complete","nextjournal.clerk.render.code/builtin-keymap","nextjournal.clojure-mode.keymap/builtin","nextjournal.clerk.render.code/paredit-keymap","nextjournal.clojure-mode.keymap/paredit","nextjournal.clerk.render.code/read-only","nextjournal.clerk.render.code/on-change-ext","f","js/module$node_modules$$codemirror$state$dist$index_cjs.EditorState","tr","G__53724","nextjournal.clerk.render.code/default-extensions","nextjournal.clojure-mode/default-extensions","js/module$node_modules$$codemirror$language$dist$index_cjs.syntaxHighlighting","nextjournal.clerk.render.code/make-state","doc","extensions","nextjournal.clerk.render.code/make-view","state","parent","G__53730","nextjournal.clerk.render.code/editor","p__53732","map__53733","p1__53725#","!code-str","nextjournal.clerk.render.code.editor","on-change","cljs.core/reset!","!container-el","nextjournal.clerk.render.hooks.use_ref","!view","nextjournal.clerk.render.hooks.use_effect","view","cljs.core/deref","G__53734","cljs.core/seq","cljs.core.not_EQ_"],"sourcesContent":["(ns nextjournal.clerk.render.code\n  (:require [\"@codemirror/language\" :refer [HighlightStyle syntaxHighlighting]]\n            [\"@codemirror/state\" :refer [EditorState RangeSetBuilder Text]]\n            [\"@codemirror/view\" :refer [EditorView Decoration keymap]]\n            [\"@lezer/highlight\" :refer [tags highlightTree]]\n            [\"@nextjournal/lang-clojure\" :refer [clojureLanguage]]\n            [applied-science.js-interop :as j]\n            [clojure.string :as str]\n            [nextjournal.clerk.render.hooks :as hooks]\n            [nextjournal.clojure-mode :as clojure-mode]\n            [nextjournal.clojure-mode.keymap :as clojure-mode.keymap]))\n\n(def highlight-style\n  (.define HighlightStyle\n           (clj->js [{:tag (.-meta tags) :class \"cmt-meta\"}\n                     {:tag (.-link tags) :class \"cmt-link\"}\n                     {:tag (.-heading tags) :class \"cmt-heading\"}\n                     {:tag (.-emphasis tags) :class \"cmt-italic\"}\n                     {:tag (.-strong tags) :class \"cmt-strong\"}\n                     {:tag (.-strikethrough tags) :class \"cmt-strikethrough\"}\n                     {:tag (.-keyword tags) :class \"cmt-keyword\"}\n                     {:tag (.-atom tags) :class \"cmt-atom\"}\n                     {:tag (.-bool tags) :class \"cmt-bool\"}\n                     {:tag (.-url tags) :class \"cmt-url\"}\n                     {:tag (.-contentSeparator tags) :class \"cmt-contentSeparator\"}\n                     {:tag (.-labelName tags) :class \"cmt-labelName\"}\n                     {:tag (.-literal tags) :class \"cmt-literal\"}\n                     {:tag (.-inserted tags) :class \"cmt-inserted\"}\n                     {:tag (.-string tags) :class \"cmt-string\"}\n                     {:tag (.-deleted tags) :class \"cmt-deleted\"}\n                     {:tag (.-regexp tags) :class \"cmt-regexp\"}\n                     {:tag (.-escape tags) :class \"cmt-escape\"}\n                     {:tag (.. tags (special (.-string tags))) :class \"cmt-string\"}\n                     {:tag (.. tags (definition (.-variableName tags))) :class \"cmt-variableName\"}\n                     {:tag (.. tags (local (.-variableName tags))) :class \"cmt-variableName\"}\n                     {:tag (.-typeName tags) :class \"cmt-typeName\"}\n                     {:tag (.-namespace tags) :class \"cmt-namespace\"}\n                     {:tag (.-className tags) :class \"cmt-className\"}\n                     {:tag (.. tags (special (.-variableName tags))) :class \"cmt-variableName\"}\n                     {:tag (.-macroName tags) :class \"cmt-macroName\"}\n                     {:tag (.. tags (definition (.-propertyName tags))) :class \"cmt-propertyName\"}\n                     {:tag (.-comment tags) :class \"cmt-comment\"}\n                     {:tag (.-invalid tags) :class \"cmt-invalid\"}])))\n\n(defn rangeset-seq\n  \"Returns a lazy-seq of ranges inside a RangeSet (like a Decoration set)\"\n  ([rset] (rangeset-seq rset 0))\n  ([^js rset from]\n   (let [iterator (.iter rset from)]\n     ((fn step []\n        (when-some [val (.-value iterator)]\n          (let [from (.-from iterator) to (.-to iterator)]\n            (.next iterator)\n            (cons {:from from :to to :val val}\n                  (lazy-seq (step))))))))))\n\n(j/defn style->hiccup-tag [^js {:keys [tagName class]}]\n  (keyword (apply str tagName\n                  (when class\n                    (cons \".\" (interpose \".\" (str/split class #\" \")))))))\n\n(j/defn intersects? [^js {:keys [from to]} range]\n  (or\n   (and (<= from (:from range)) (< (:from range) to))\n   (and (< from (:to range)) (<= (:to range) to))\n   (and (<= (:from range) from) (<= to (:to range)))))\n\n(defn style-line [decos ^js text i]\n  (j/let [^js {:as line :keys [from to length]} (.line text i)]\n    ;; NOTE: these styles are partially overlapping with those for the `.viewer-code` container\n    ;; but are needed to fix rendered code _outside_ of it. e.g. in Clerk results\n    (into [:div.cm-line {:style {:padding \"0\"\n                                 :line-height \"1.6\"\n                                 :font-size \"15px\"\n                                 :font-family \"\\\"Fira Mono\\\", monospace\"}}]\n          (if (zero? length)\n            \"\\n\"\n            (loop [pos from\n                   lds (filter (partial intersects? line) (rangeset-seq decos))\n                   buf ()]\n              (if-some [{start :from end :to style :val} (first lds)]\n                (recur end\n                       (next lds)\n                       (concat buf (cond-> (list [(style->hiccup-tag style) (.sliceString text (max from start) (min to end))])\n                                     (< pos start)\n                                     (conj (.sliceString text pos start)))))\n                (cond-> buf\n                  (< pos to)\n                  (concat [(.sliceString text pos to)]))))))))\n\n(defn render-code [^String code]\n  (let [builder (RangeSetBuilder.)\n        _ (highlightTree (.. clojureLanguage -parser (parse code)) highlight-style\n                         (fn [from to style]\n                           (.add builder from to (.mark Decoration (j/obj :class style)))))\n        decorations-rangeset (.finish builder)\n        text (.of Text (.split code \"\\n\"))]\n    [:div.cm-editor\n     [:cm-scroller\n      (into [:div.cm-content.whitespace-pre]\n            (map (partial style-line decorations-rangeset text))\n            (range 1 (inc (.-lines text))))]]))\n\n;; editable code viewer\n(def theme\n  (.theme EditorView\n          (j/lit {\"&.cm-focused\" {:outline \"none\"}\n                  \".cm-line\" {:padding \"0\"\n                              :line-height \"1.6\"\n                              :font-size \"15px\"\n                              :font-family \"\\\"Fira Mono\\\", monospace\"}\n                  \".cm-matchingBracket\" {:border-bottom \"1px solid var(--teal-color)\"\n                                         :color \"inherit\"}\n\n                  ;; only show cursor when focused\n                  \".cm-cursor\" {:visibility \"hidden\"}\n                  \"&.cm-focused .cm-cursor\" {:visibility \"visible\"\n                                             :animation \"steps(1) cm-blink 1.2s infinite\"}\n                  \"&.cm-focused .cm-selectionBackground\" {:background-color \"Highlight\"}\n                  \".cm-tooltip\" {:border \"1px solid rgba(0,0,0,.1)\"\n                                 :border-radius \"3px\"\n                                 :overflow \"hidden\"}\n                  \".cm-tooltip > ul > li\" {:padding \"3px 10px 3px 0 !important\"}\n                  \".cm-tooltip > ul > li:first-child\" {:border-top-left-radius \"3px\"\n                                                       :border-top-right-radius \"3px\"}})))\n\n(def ^js complete-keymap (.of keymap clojure-mode.keymap/complete))\n(def ^js builtin-keymap (.of keymap clojure-mode.keymap/builtin))\n(def ^js paredit-keymap (.of keymap clojure-mode.keymap/paredit))\n\n(def read-only (.. EditorView -editable (of false)))\n\n(defn on-change-ext [f]\n  (.. EditorState -transactionExtender\n      (of (fn [^js tr]\n            (when (.-docChanged tr) (f (.. tr -state sliceDoc)))\n            #js {}))))\n\n(def ^:export default-extensions\n  #js [clojure-mode/default-extensions\n       (syntaxHighlighting highlight-style)\n       theme])\n\n(defn make-state [doc extensions]\n  (.create EditorState (j/obj :doc doc :extensions extensions)))\n\n(defn make-view [state parent]\n  (EditorView. (j/obj :state state :parent parent)))\n\n(defn editor\n  ([!code-str] (editor !code-str {}))\n  ([!code-str {:keys [extensions on-change]\n               :or {on-change #(reset! !code-str %)}}]\n   (let [!container-el (hooks/use-ref nil)\n         !view (hooks/use-ref nil)]\n     ;; view instance is built only once\n     (hooks/use-effect\n      (fn []\n        (let [^js view\n              (reset! !view (make-view (make-state @!code-str\n                                                   (cond-> default-extensions\n                                                     (seq extensions) (.concat extensions)\n                                                     on-change (.concat (on-change-ext on-change)))) @!container-el))]\n          #(.destroy view))))\n     (hooks/use-effect\n      (fn []\n        (let [^js state (.-state @!view)]\n          (when (not= @!code-str (.sliceDoc state))\n            (.dispatch @!view\n                       (.update state\n                                (j/lit {:changes [{:insert @!code-str\n                                                   :from 0 :to (.. state -doc -length)}]}))))))\n      [@!code-str])\n     [:div {:ref !container-el}])))\n"]}